<%- include("../partials/header") %>

<div class="form">
  <% if (query.from) { %><a class="form__link" href="<%- query.from %>">Back</a><% } %>
  <div class="form__title">View Tutor Profile</div>
  <% if (currentUser.accessLevel <= 1) { %>
    <p class="form__description">If you wish to delete your tutor profile, contact the tutoring coordinator.</p>
  <% } if (currentUser.id == tutor.id) { %>
    <p class="form__description">
      <% if (tutor.verified && tutor.verifiedPhone) { %>
        <span class="material-icons form__icon green">done</span>
        <span class="green">You are verified and will be paired with tutees if found a match.</span>
      <% } else { %>
        <span class="material-icons form__icon orange">warning</span>
        <span class="orange">You will not be paired with tutees until you are verified. To be verified, you must
          <% if (!tutor.verified && !tutor.verifiedPhone) { %>
            attend one of the training sessions, turn in the tutoring permission form, and click the verification link sent to your phone.
          <% } else if (!tutor.verified) { %>
            attend one of the training sessions and turn in the tutoring permission form. If you have done this, allow some time for CSF to verify you.
          <% } else if (!tutor.verifiedPhone) { %>
            click the verification link sent to your phone. <a class="link--gray" href="/tutors/<%- tutor._id %>/resend-verification">Resend verification</a>
          <% } %>
        </span>
      <% } %>
    </p>
  <% } %>
  <div class="form__item">
    <label class="form__label" for="id">Student ID</label>
    <input class="form__input" value="<%- tutor.id %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="name">Name</label>
    <input class="form__input" value="<%- tutor.name %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="grade">Grade</label>
    <input class="form__input" value="<%- tutor.grade %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="gender">Gender</label>
    <input class="form__input" value="<%- tutor.gender %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="email">Email</label>
    <input class="form__input" value="<%- tutor.email %>" readonly/>
    <span class="form__input-footnote">Only used to contact you as a last resort</span>
  </div>
  <div class="form__item">
    <label class="form__label" for="phoneNum">Phone Number</label>
    <input class="form__input" value="<%- tutor.phoneNum %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="maxTutees">Maximum Tutees</label>
    <input class="form__input" value="<%- tutor.maxTutees %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="paymentForm">Form of Payment</label>
    <input class="form__input" value="<%- tutor.paymentForm %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="tuteeSessions">Current Tutees</label>
    <% if (currentUser.accessLevel < 2) tutor.tuteeSessions = tutor.tuteeSessions.filter(tuteeSession => tuteeSession.status != "Unnotified");
    if (tutor.tuteeSessions.length == 0) { %>
      <input class="form__input" type="text" value="Not yet paired with tutees" readonly/>
    <% } else {
      tutor.tuteeSessions.forEach(function(tuteeSession) { %>
      <div class="card">
        <div class="card__title">
          <span class="card__icon material-icons">account_circle</span>Tutee <%- tuteeSession.tuteeID %>
          <% if (currentUser.accessLevel >= 2) { %>
            <span class="card__icon card__icon--link card__icon--right no-select material-icons">more_horiz</span>
            <div class="card__dropdown">
              <a class="card__dropdown-link" href="/tutors/<%- tutor._id %>/notify/<%- tuteeSession.tuteeID %>">Notify Tutor</a>
              <a class="card__dropdown-link" href="/tutors/<%- tutor._id %>/unpair/<%- tuteeSession.tuteeID %>">Unpair</a>
            </div>
          <% } %>
        </div>
        <span class="card__footnote">Status - <%- tuteeSession.status %></span>
        <span class="card__footnote">
          Courses - <%- ejs.reformatCourse(tuteeSession.courses[0]) %><% for (var i=1; i<tuteeSession.courses.length; i++) { %><%- ", " + ejs.reformatCourse(tuteeSession.courses[i]) %><% } %>
        </span>
      </div>
      <% });
    } %>
  </div>
  <div class="form__item">
    <label class="form__label" for="courses">Courses to Tutor</label>
    <input class="form__input" value="<%- ejs.reformatCourse(tutor.courses[0]) %><% for (var i=1; i<tutor.courses.length; i++) { %><%- ", " + ejs.reformatCourse(tutor.courses[i]) %><% } %>" readonly/>
  </div>
  <div class="form__item">
    <label class="form__label" for="verified">Verification Status</label>
    <input class="form__input" value="<% if (tutor.verified && tutor.verifiedPhone) { %>Verified<% } else { %>Unverified<% } %>" readonly/>
    <span class="form__input-footnote">
      CSF Verified: <% if (tutor.verified) { %>True<% } else { %>False<% } %>,&nbsp;&nbsp;&nbsp;
      Phone Verified: <% if (tutor.verifiedPhone) { %>True<% } else { %>False - <a class="link--gray" href="/tutors/<%- tutor._id %>/resend-verification">Resend verification</a><% } %>
    </span>
  </div>
  <% if (currentUser.accessLevel >= 2) { %>
    <div class="form__item">
      <label class="form__label" for="warnings">Warnings</label>
      <input class="form__input" value="<%- tutor.warnings %>" readonly/>
    </div>
  <% } %>
  <div class="form__item form__item--row">
    <a class="form__button" href="/tutors/<%- tutor._id %>/edit<% if (query.from) { %>?from=<%- query.from.replace(/\//g, "%2F") %><% } %>">Edit</a>
    <% if (currentUser.accessLevel >= 2) {
      if (tutor.verified) { %>
        <form action="/tutors/<%- tutor._id %>/unverify?_method=put<% if (query.from) { %>&from=<%- query.from %><% } %>" method="post" onsubmit="return confirm('Are you sure you want to unverify this tutor?')">
          <input class="form__button" type="submit" value="Unverify"/>
        </form>
      <% } else if (!tutor.verified) { %>
        <form action="/tutors/<%- tutor._id %>/verify?_method=put<% if (query.from) { %>&from=<%- query.from %><% } %>" method="post" onsubmit="return confirm('Are you sure you want to verify this tutor?')">
          <input class="form__button" type="submit" value="Verify"/>
        </form>
      <% } %>
      <form action="/tutors/<%- tutor._id %>/warn?_method=put<% if (query.from) { %>&from=<%- query.from %><% } %>" method="post" onsubmit="return confirm('Are you sure you want to add a warning to this tutor?')">
        <input class="form__button form__button--orange" type="submit" value="Warn"/>
      </form>
      <form action="/tutors/<%- tutor._id %>?_method=delete<% if (query.from) { %>&from=<%- query.from %><% } %>" method="post" onsubmit="return confirm('Are you sure you want to delete this tutor?')">
        <button class="form__button form__button--red" type="submit">Delete</button>
      </form>
    <% } %>
  </div>
</div>

<%- include("../partials/footer") %>
