<%- include("../partials/header") %>

<div class="above-table">
  <div class="search search__input-container" id="filterTable">
    <input class="search__input" type="text" spellcheck="false" placeholder="Filter meetings"/>
    <span class="material-icons search__icon">search</span>
  </div>
  <% if (currentUser && currentUser.accessLevel >= 1) { %>
    <div class="above-table__section">
      <a class="above-table__button no-drag" href="/meetings/new"><span class="material-icons above-table__icon">event</span>New Meeting</a>
    </div>
  <% } %>
</div>
<table class="table">
  <thead>
    <tr class="table__head-row">
      <th class="table__cell">Meeting</th>
      <th class="table__cell">Date</th>
      <th class="table__cell">Description</th>
      <% if (currentUser && currentUser.meetingsAttended) { %>
        <th class="table__cell">Attendance</th>
      <% } %>
    </tr>
  </thead>
  <tbody>
    <% i=1; meetings.forEach(function(meeting) { %>
      <tr class="table__body-row" data-href="/meetings/<%- meeting._id %>">
        <td class="table__cell"><%- i %></td>
        <td class="table__cell"><%- ejs.reformatDate(meeting.date) %></td>
        <td class="table__cell"><%- meeting.description %></td>
        <% if (currentUser && currentUser.meetingsAttended) { %>
          <td class="table__cell">
            <% if (currentUser && currentUser.meetingsAttended && currentUser.meetingsAttended.includes(meeting.date)) { %><span class="green">Attended</span>
            <% } else if (new Date(meeting.date) > new Date(new Date().toLocaleString("en-US", {timeZone: "America/Los_Angeles"}))) { %><span class="blue">Upcoming</span>
            <% } else { %><span class="red">Not attended</span><% } %>
          </td>
        <% } %>
      </tr>
    <% i++; }); %>
  </tbody>
</table>

<%- include("../partials/footer") %>
